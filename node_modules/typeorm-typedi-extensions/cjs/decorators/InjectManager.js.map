{"version":3,"file":"InjectManager.js","sourceRoot":"","sources":["../../../src/decorators/InjectManager.ts"],"names":[],"mappings":";;;AAAA,qCAA4C;AAC5C,mCAAkD;AAElD;;GAEG;AACH,SAAgB,aAAa,CAAC,iBAAyB,SAAS;IAC9D,OAAO,UAAU,MAAyB,EAAE,YAAoB,EAAE,KAAc;QAC9E,kBAAS,CAAC,eAAe,CAAC;YACxB,MAAM,EAAE,MAAgC;YACxC,KAAK;YACL,YAAY;YACZ,KAAK,EAAE,GAAG,EAAE;gBACV,MAAM,iBAAiB,GAAG,kBAAS,CAAC,GAAG,CAAC,2BAAiB,CAAC,CAAC;gBAC3D,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,cAAc,CAAC;oBACxC,MAAM,IAAI,KAAK,CACb,0BAA0B,cAAc,iCAAiC;wBACvE,qGAAqG;wBACrG,mFAAmF,CACtF,CAAC;gBAEJ,MAAM,UAAU,GAAG,iBAAiB,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;gBACzD,MAAM,aAAa,GAAG,UAAU,CAAC,OAAO,CAAC;gBACzC,IAAI,CAAC,aAAa;oBAChB,MAAM,IAAI,KAAK,CACb,oCAAoC,cAAc,gBAAgB;wBAChE,+DAA+D,CAClE,CAAC;gBAEJ,OAAO,aAAa,CAAC;YACvB,CAAC;SACF,CAAC,CAAC;IACL,CAAC,CAAC;AACJ,CAAC;AA3BD,sCA2BC","sourcesContent":["import { ConnectionManager } from 'typeorm';\nimport { Constructable, Container } from 'typedi';\n\n/**\n * Allows to inject an EntityManager using typedi's Container.\n */\nexport function InjectManager(connectionName: string = 'default'): Function {\n  return function (object: Object | Function, propertyName: string, index?: number) {\n    Container.registerHandler({\n      object: object as Constructable<unknown>,\n      index,\n      propertyName,\n      value: () => {\n        const connectionManager = Container.get(ConnectionManager);\n        if (!connectionManager.has(connectionName))\n          throw new Error(\n            `Cannot get connection \"${connectionName}\" from the connection manager. ` +\n              `Make sure you have created such connection. Also make sure you have called useContainer(Container) ` +\n              `in your application before you established a connection and importing any entity.`\n          );\n\n        const connection = connectionManager.get(connectionName);\n        const entityManager = connection.manager;\n        if (!entityManager)\n          throw new Error(\n            `Entity manager was not found on \"${connectionName}\" connection. ` +\n              `Make sure you correctly setup connection and container usage.`\n          );\n\n        return entityManager;\n      },\n    });\n  };\n}\n"]}